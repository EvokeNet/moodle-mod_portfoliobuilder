{"version":3,"file":"edit.min.js","sources":["../../src/comment/edit.js"],"sourcesContent":["/**\n * Edit chapter js logic.\n *\n * @copyright  2021 World Bank Group <https://worldbank.org>\n * @author     Willian Mano <willianmanoaraujo@gmail.com>\n */\n/* eslint-disable */\ndefine([\n        'jquery',\n        'core/str',\n        'core/modal_factory',\n        'core/modal_events',\n        'core/ajax',\n        'mod_portfoliobuilder/tribute_init',\n        'mod_portfoliobuilder/sweetalert',\n        'core/yui'],\n    function($, Str, ModalFactory, ModalEvents, Ajax, TributeInit, Swal, Y) {\n\n        var EditComment = function(contextid) {\n            this.contextid = contextid;\n\n            this.registerEventListeners();\n        };\n\n        /**\n         * @var {int} contextid\n         * @private\n         */\n        EditComment.prototype.contextid = -1;\n\n        /**\n         * @var eventtarget\n         * @private\n         */\n        EditComment.prototype.eventtarget = null;\n\n        EditComment.prototype.registerEventListeners = function() {\n            $(\"body\").on(\"click\", \".btn-editcomment\", function (event) {\n                event.preventDefault();\n\n                this.eventtarget = $(event.currentTarget);\n\n                let commentId = this.eventtarget.data('id');\n\n                var textdiv = this.eventtarget.closest('.submissioncomment').children('.text');\n\n                Str.get_string('editcomment', 'mod_portfoliobuilder').then(function(title) {\n                    ModalFactory.create({\n                        type: ModalFactory.types.SAVE_CANCEL,\n                        title: title,\n                        body: '<div class=\"input-group\">' +\n                            '<p class=\"post-comment-input\" contenteditable=\"true\" data-tribute=\"true\">' + textdiv.html() + '</p>' +\n                            '</div>',\n                    }).then(function(modal) {\n                        modal.getRoot().on(ModalEvents.save, function () {\n                            var newMessage = modal.getBody().find('.post-comment-input').html();\n\n                            this.saveComment(commentId, newMessage);\n                        }.bind(this));\n\n                        modal.show().then(TributeInit.init());\n                    }.bind(this));\n                }.bind(this));\n            }.bind(this));\n        }\n\n        EditComment.prototype.saveComment = function(id, message) {\n            var request = Ajax.call([{\n                methodname: 'mod_portfoliobuilder_editcomment',\n                args: {\n                    comment: {\n                        id: id,\n                        message: message,\n                    }\n                }\n            }]);\n\n            request[0].done(function(data) {\n                this.replaceOriginalMessage(message);\n\n                this.showToast('success', data.message);\n            }.bind(this)).fail(function(error) {\n                var message = error.message;\n\n                if (!message) {\n                    message = error.error;\n                }\n\n                this.showToast('error', message);\n            }.bind(this));\n        };\n\n        EditComment.prototype.replaceOriginalMessage = function(newMessage) {\n            var submissioncommentdiv = this.eventtarget.closest('.submissioncomment');\n            var textdiv = submissioncommentdiv.children('.text');\n\n            submissioncommentdiv.css('background-color', '#cceecb');\n            submissioncommentdiv.css('transition', 'background 1s');\n\n            window.setInterval(function() {\n                submissioncommentdiv.css('background-color', 'initial');\n            }, 1000);\n\n            textdiv.html(newMessage);\n        }\n\n        EditComment.prototype.showToast = function(type, message) {\n            var Toast = Swal.mixin({\n                toast: true,\n                position: 'top-end',\n                showConfirmButton: false,\n                timer: 8000,\n                timerProgressBar: true,\n                onOpen: (toast) => {\n                    toast.addEventListener('mouseenter', Swal.stopTimer);\n                    toast.addEventListener('mouseleave', Swal.resumeTimer);\n                }\n            });\n\n            Toast.fire({\n                icon: type,\n                title: message\n            });\n        };\n\n        return {\n            init: function(contextid) {\n                return new EditComment(contextid);\n            }\n        };\n    }\n);\n"],"names":["define","$","Str","ModalFactory","ModalEvents","Ajax","TributeInit","Swal","Y","EditComment","contextid","registerEventListeners","prototype","eventtarget","on","event","preventDefault","currentTarget","commentId","this","data","textdiv","closest","children","get_string","then","title","create","type","types","SAVE_CANCEL","body","html","modal","getRoot","save","newMessage","getBody","find","saveComment","bind","show","init","id","message","call","methodname","args","comment","done","replaceOriginalMessage","showToast","fail","error","submissioncommentdiv","css","window","setInterval","mixin","toast","position","showConfirmButton","timer","timerProgressBar","onOpen","addEventListener","stopTimer","resumeTimer","fire","icon"],"mappings":"AAOAA,2CAAO,CACC,SACA,WACA,qBACA,oBACA,YACA,oCACA,kCACA,aACJ,SAASC,EAAGC,IAAKC,aAAcC,YAAaC,KAAMC,YAAaC,KAAMC,OAE7DC,YAAc,SAASC,gBAClBA,UAAYA,eAEZC,iCAOTF,YAAYG,UAAUF,WAAa,EAMnCD,YAAYG,UAAUC,YAAc,KAEpCJ,YAAYG,UAAUD,uBAAyB,WAC3CV,EAAE,QAAQa,GAAG,QAAS,mBAAoB,SAAUC,OAChDA,MAAMC,sBAEDH,YAAcZ,EAAEc,MAAME,mBAEvBC,UAAYC,KAAKN,YAAYO,KAAK,UAElCC,QAAUF,KAAKN,YAAYS,QAAQ,sBAAsBC,SAAS,SAEtErB,IAAIsB,WAAW,cAAe,wBAAwBC,KAAK,SAASC,OAChEvB,aAAawB,OAAO,CAChBC,KAAMzB,aAAa0B,MAAMC,YACzBJ,MAAOA,MACPK,KAAM,qGAC4EV,QAAQW,OADpF,eAGPP,KAAK,SAASQ,OACbA,MAAMC,UAAUpB,GAAGV,YAAY+B,KAAM,eAC7BC,WAAaH,MAAMI,UAAUC,KAAK,uBAAuBN,YAExDO,YAAYrB,UAAWkB,aAC9BI,KAAKrB,OAEPc,MAAMQ,OAAOhB,KAAKnB,YAAYoC,SAChCF,KAAKrB,QACTqB,KAAKrB,QACTqB,KAAKrB,QAGXV,YAAYG,UAAU2B,YAAc,SAASI,GAAIC,SAC/BvC,KAAKwC,KAAK,CAAC,CACrBC,WAAY,mCACZC,KAAM,CACFC,QAAS,CACLL,GAAIA,GACJC,QAASA,aAKb,GAAGK,KAAK,SAAS7B,WAChB8B,uBAAuBN,cAEvBO,UAAU,UAAW/B,KAAKwB,UACjCJ,KAAKrB,OAAOiC,KAAK,SAASC,WACpBT,QAAUS,MAAMT,QAEfA,UACDA,QAAUS,MAAMA,YAGfF,UAAU,QAASP,UAC1BJ,KAAKrB,QAGXV,YAAYG,UAAUsC,uBAAyB,SAASd,gBAChDkB,qBAAuBnC,KAAKN,YAAYS,QAAQ,sBAChDD,QAAUiC,qBAAqB/B,SAAS,SAE5C+B,qBAAqBC,IAAI,mBAAoB,WAC7CD,qBAAqBC,IAAI,aAAc,iBAEvCC,OAAOC,aAAY,WACfH,qBAAqBC,IAAI,mBAAoB,aAC9C,KAEHlC,QAAQW,KAAKI,aAGjB3B,YAAYG,UAAUuC,UAAY,SAASvB,KAAMgB,SACjCrC,KAAKmD,MAAM,CACnBC,OAAO,EACPC,SAAU,UACVC,mBAAmB,EACnBC,MAAO,IACPC,kBAAkB,EAClBC,OAASL,QACLA,MAAMM,iBAAiB,aAAc1D,KAAK2D,WAC1CP,MAAMM,iBAAiB,aAAc1D,KAAK4D,gBAI5CC,KAAK,CACPC,KAAMzC,KACNF,MAAOkB,WAIR,CACHF,KAAM,SAAShC,kBACJ,IAAID,YAAYC"}