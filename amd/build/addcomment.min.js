define("mod_portfoliobuilder/addcomment",["jquery","core/str","core/ajax","mod_portfoliobuilder/sweetalert"],(function($,Str,Ajax,Swal){var AddComment=function(){this.registerEventListeners()};return AddComment.prototype.registerEventListeners=function(){$(document).on("click",".post-comment-btn",function(event){var target=$(event.currentTarget).closest(".input-group").children(".post-comment-input");target&&this.saveComment(target,target.html())}.bind(this))},AddComment.prototype.saveComment=function(postinput,value){if(""!==value){var entrydiv=postinput.closest(".entry");if(postinput.empty(),0===entrydiv.length||entrydiv.length>1)this.showToast("error","Error trying to find the discussion for this comment.");else{var id=entrydiv.data("id");Ajax.call([{methodname:"mod_portfoliobuilder_addcomment",args:{comment:{entryid:id,message:value}}}])[0].done(function(data){this.addCommentToEntry(entrydiv,data.comment)}.bind(this)).fail(function(error){var message=error.message;message||(message=error.error),this.showToast("error",message)}.bind(this))}}},AddComment.prototype.showToast=function(type,message){Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:8e3,timerProgressBar:!0,onOpen:toast=>{toast.addEventListener("mouseenter",Swal.stopTimer),toast.addEventListener("mouseleave",Swal.resumeTimer)}}).fire({icon:type,title:message})},AddComment.prototype.addCommentToEntry=function(entrydiv,comment){Str.get_string("editcomment","mod_portfoliobuilder").then((function(editcomment){var userimg=entrydiv.find(".add-comment .userimg").clone(),userfullname=userimg.attr("alt"),loadallcomments=entrydiv.find(".loadmore"),commentcontainer=$("<div class='submissioncomment fadeIn'><div class='userinfo'><div class='userimg'>"+$("<div/>").append(userimg).html()+"</div><div class='nameanddate'><p class='username'>"+userfullname+"</p><span class='small'>"+comment.humantimecreated+"</span></div><div class='editbutton ml-auto'><a class='btn-editcomment btn btn-sm btn-primary' data-id='"+comment.id+"'>"+editcomment+"</a></div></div><p class='text'>"+comment.message+"</p></div>");loadallcomments.length>0?commentcontainer.insertBefore(loadallcomments):commentcontainer.insertBefore(entrydiv.find(".add-comment"));var totalcommentsspan=entrydiv.find(".reactions .actions .commentbutton .totalcomments"),totalcomments=entrydiv.find(".submissioncomment").length;totalcommentsspan.empty(),totalcommentsspan.text(totalcomments)}))},{init:function(){return new AddComment}}}));

//# sourceMappingURL=addcomment.min.js.map