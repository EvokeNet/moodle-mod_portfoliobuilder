{"version":3,"file":"infinitescroll.min.js","sources":["../src/infinitescroll.js"],"sourcesContent":["/**\n * Add comment js logic.\n *\n * @package\n * @subpackage mod_portfoliobuilder\n * @copyright  2022 World Bank Group <https://worldbank.org>\n * @author     Willian Mano <willianmanoaraujo@gmail.com>\n */\n/* eslint-disable */\ndefine(['jquery', 'core/ajax', 'core/templates', 'mod_portfoliobuilder/tribute_init'], function($, Ajax, Templates, TributeInit) {\n    var InfiniteScroll = function(courseid) {\n        this.courseid = courseid;\n\n        this.tribute = TributeInit.init();\n\n        this.targetdiv = '#' + this.type + 'portfolio';\n\n        this.controlbutton = document.getElementById(this.type + 'portfolio-tab');\n\n        this.type = this.controlbutton.dataset.timeline_type;\n        this.offset = parseInt(this.controlbutton.dataset.timeline_offset);\n        this.hasmoreitems = this.controlbutton.dataset.timeline_hasmoreitems;\n\n        this.loadItems();\n\n        document.addEventListener('scroll', function(event) {\n            var scrollTop = event.target.scrollingElement.scrollTop;\n            var scrollHeight = event.target.scrollingElement.scrollHeight;\n            var offsetHeight = event.target.scrollingElement.offsetHeight;\n\n            if (this.hasmoreitems && !this.wait && (scrollTop + offsetHeight > scrollHeight - 40)) {\n                if (!this.hasmoreitems) {\n                    return;\n                }\n\n                if (!this.wait) {\n                    this.loadItems();\n                }\n            }\n        }.bind(this), false);\n\n        $('.nav-tabs .nav-link, .nav-pills .nav-link').click(function(event) {\n            this.controlbutton = event.target;\n\n            this.type = event.target.dataset.timeline_type;\n            this.offset = parseInt(event.target.dataset.timeline_offset);\n            this.hasmoreitems = event.target.dataset.timeline_hasmoreitems === 'true';\n\n            this.targetdiv = event.target.dataset.target;\n\n            this.loadItems();\n        }.bind(this));\n    }\n\n    InfiniteScroll.prototype.loadItems = function() {\n        this.wait = true;\n\n        const request = Ajax.call([{\n            methodname: 'mod_portfoliobuilder_loadtimeline',\n            args: {\n                courseid: this.courseid,\n                type: this.type,\n                offset: this.offset\n            }\n        }]);\n\n        request[0].done(function(response) {\n            var data = JSON.parse(response.data);\n\n            this.offset = parseInt(this.offset + 1);\n            this.controlbutton.dataset.timeline_offset = this.offset;\n            this.hasmoreitems = data.hasmoreitems;\n            this.controlbutton.dataset.timeline_hasmoreitems = data.hasmoreitems;\n\n            this.handleLoadData(data);\n        }.bind(this));\n    };\n\n    InfiniteScroll.prototype.handleLoadData = function(data) {\n        console.log(data);\n        const targetdiv = $(this.targetdiv);\n\n        targetdiv.find('.entry_loading-placeholder').addClass('hidden');\n\n        $.each(data, function(index, value) {\n            console.log(value);\n            Templates.render('mod_portfoliobuilder/entry', value).then(function(content) {\n                targetdiv.find('.entries').append(content);\n            });\n        });\n\n        this.tribute.reload();\n\n        this.wait = false;\n    };\n\n    InfiniteScroll.prototype.courseid = 0;\n\n    InfiniteScroll.prototype.type = 'my';\n\n    InfiniteScroll.prototype.offset = 0;\n\n    InfiniteScroll.prototype.hasmoreitems = true;\n\n    InfiniteScroll.prototype.targetdiv = '#myportfolio';\n\n    InfiniteScroll.prototype.wait = false;\n\n    InfiniteScroll.prototype.tribute = null;\n\n    InfiniteScroll.prototype.controlbutton = null;\n\n    return {\n        'init': function(courseid) {\n            return new InfiniteScroll(courseid);\n        }\n    };\n});\n"],"names":["define","$","Ajax","Templates","TributeInit","InfiniteScroll","courseid","tribute","init","targetdiv","this","type","controlbutton","document","getElementById","dataset","timeline_type","offset","parseInt","timeline_offset","hasmoreitems","timeline_hasmoreitems","loadItems","addEventListener","event","scrollTop","target","scrollingElement","scrollHeight","offsetHeight","wait","bind","click","prototype","call","methodname","args","done","response","data","JSON","parse","handleLoadData","console","log","find","addClass","each","index","value","render","then","content","append","reload"],"mappings":"AASAA,6CAAO,CAAC,SAAU,YAAa,iBAAkB,sCAAsC,SAASC,EAAGC,KAAMC,UAAWC,iBAC5GC,eAAiB,SAASC,eACrBA,SAAWA,cAEXC,QAAUH,YAAYI,YAEtBC,UAAY,IAAMC,KAAKC,KAAO,iBAE9BC,cAAgBC,SAASC,eAAeJ,KAAKC,KAAO,sBAEpDA,KAAOD,KAAKE,cAAcG,QAAQC,mBAClCC,OAASC,SAASR,KAAKE,cAAcG,QAAQI,sBAC7CC,aAAeV,KAAKE,cAAcG,QAAQM,2BAE1CC,YAELT,SAASU,iBAAiB,SAAU,SAASC,WACrCC,UAAYD,MAAME,OAAOC,iBAAiBF,UAC1CG,aAAeJ,MAAME,OAAOC,iBAAiBC,aAC7CC,aAAeL,MAAME,OAAOC,iBAAiBE,gBAE7CnB,KAAKU,eAAiBV,KAAKoB,MAASL,UAAYI,aAAeD,aAAe,GAAK,KAC9ElB,KAAKU,oBAILV,KAAKoB,WACDR,cAGfS,KAAKrB,OAAO,GAEdT,EAAE,6CAA6C+B,MAAM,SAASR,YACrDZ,cAAgBY,MAAME,YAEtBf,KAAOa,MAAME,OAAOX,QAAQC,mBAC5BC,OAASC,SAASM,MAAME,OAAOX,QAAQI,sBACvCC,aAA8D,SAA/CI,MAAME,OAAOX,QAAQM,2BAEpCZ,UAAYe,MAAME,OAAOX,QAAQW,YAEjCJ,aACPS,KAAKrB,eAGXL,eAAe4B,UAAUX,UAAY,gBAC5BQ,MAAO,EAEI5B,KAAKgC,KAAK,CAAC,CACvBC,WAAY,oCACZC,KAAM,CACF9B,SAAUI,KAAKJ,SACfK,KAAMD,KAAKC,KACXM,OAAQP,KAAKO,WAIb,GAAGoB,KAAK,SAASC,cACjBC,KAAOC,KAAKC,MAAMH,SAASC,WAE1BtB,OAASC,SAASR,KAAKO,OAAS,QAChCL,cAAcG,QAAQI,gBAAkBT,KAAKO,YAC7CG,aAAemB,KAAKnB,kBACpBR,cAAcG,QAAQM,sBAAwBkB,KAAKnB,kBAEnDsB,eAAeH,OACtBR,KAAKrB,QAGXL,eAAe4B,UAAUS,eAAiB,SAASH,MAC/CI,QAAQC,IAAIL,YACN9B,UAAYR,EAAES,KAAKD,WAEzBA,UAAUoC,KAAK,8BAA8BC,SAAS,UAEtD7C,EAAE8C,KAAKR,MAAM,SAASS,MAAOC,OACzBN,QAAQC,IAAIK,OACZ9C,UAAU+C,OAAO,6BAA8BD,OAAOE,MAAK,SAASC,SAChE3C,UAAUoC,KAAK,YAAYQ,OAAOD,oBAIrC7C,QAAQ+C,cAERxB,MAAO,GAGhBzB,eAAe4B,UAAU3B,SAAW,EAEpCD,eAAe4B,UAAUtB,KAAO,KAEhCN,eAAe4B,UAAUhB,OAAS,EAElCZ,eAAe4B,UAAUb,cAAe,EAExCf,eAAe4B,UAAUxB,UAAY,eAErCJ,eAAe4B,UAAUH,MAAO,EAEhCzB,eAAe4B,UAAU1B,QAAU,KAEnCF,eAAe4B,UAAUrB,cAAgB,KAElC,MACK,SAASN,iBACN,IAAID,eAAeC"}